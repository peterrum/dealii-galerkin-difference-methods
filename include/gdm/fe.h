#pragma once

#include <deal.II/base/polynomial.h>
#include <deal.II/base/tensor_product_polynomials.h>

#include <deal.II/fe/fe_q_base.h>
#include <deal.II/fe/fe_system.h>

#include <deal.II/hp/fe_collection.h>

using namespace dealii;

namespace GDM
{

  template <int dim>
  class FE_GDM : public FE_Q_Base<dim>
  {
  public:
    FE_GDM(const ScalarPolynomialsBase<dim> &poly)
      : FE_Q_Base<dim>(poly, create_data(poly.n()), std::vector<bool>(1, false))
    {}

    std::string
    get_name() const override
    {
      std::ostringstream namebuf;
      namebuf << "FE_GDM<" << Utilities::dim_string(dim, dim) << ">("
              << this->degree << ")";
      return namebuf.str();
    }

    std::unique_ptr<FiniteElement<dim>>
    clone() const override
    {
      return std::make_unique<FE_GDM<dim>>(*this);
    }

  private:
    static FiniteElementData<dim>
    create_data(const unsigned int n)
    {
      std::vector<unsigned int> dofs_per_object(dim + 1);
      dofs_per_object[dim] = n;

      FiniteElementData<dim> fe_data(dofs_per_object,
                                     1,
                                     std::round(std::pow(n, 1.0 / dim)) - 1);

      return fe_data;
    }
  };


  std::vector<std::vector<Polynomials::Polynomial<double>>>
  generate_polynomials_1D(const unsigned int fe_degree)
  {
    std::vector<std::vector<Polynomials::Polynomial<double>>> all_polynomial;

    // clang-format off
    std::vector<std::vector<std::vector<std::vector<double>>>> all_coefficients =
      {{
        // fe_degree == 1
        {{
          {{
            {{-1.0 / 1.0, 1.0 / 1.0}},
            {{1.0 / 1.0, 0.0 / 1.0}}
          }}
        }},
        // fe_degree == 3
        {{
          {{
            {{-1.0 / 6.0, 1.0 / 1.0, -11.0 / 6.0, 1.0 / 1.0}},
            {{1.0 / 2.0, -5.0 / 2.0, 3.0 / 1.0, 0.0 / 1.0}},
            {{-1.0 / 2.0, 2.0 / 1.0, -3.0 / 2.0, 0.0 / 1.0}},
            {{1.0 / 6.0, -1.0 / 2.0, 1.0 / 3.0, 0.0 / 1.0}}
          }},
          {{
            {{-1.0 / 6.0, 1.0 / 2.0, -1.0 / 3.0, 0.0 / 1.0}},
            {{1.0 / 2.0, -1.0 / 1.0, -1.0 / 2.0, 1.0 / 1.0}},
            {{-1.0 / 2.0, 1.0 / 2.0, 1.0 / 1.0, 0.0 / 1.0}},
            {{1.0 / 6.0, 0.0 / 1.0, -1.0 / 6.0, 0.0 / 1.0}}
          }},
          {{
            {{-1.0 / 6.0, 0.0 / 1.0, 1.0 / 6.0, 0.0 / 1.0}},
            {{1.0 / 2.0, 1.0 / 2.0, -1.0 / 1.0, 0.0 / 1.0}},
            {{-1.0 / 2.0, -1.0 / 1.0, 1.0 / 2.0, 1.0 / 1.0}},
            {{1.0 / 6.0, 1.0 / 2.0, 1.0 / 3.0, 0.0 / 1.0}}
          }}
        }},
        // fe_degree == 5
        {{
          {{
            {{-1.0 / 120.0, 1.0 / 8.0, -17.0 / 24.0, 15.0 / 8.0, -137.0 / 60.0, 1.0 / 1.0}},
            {{1.0 / 24.0, -7.0 / 12.0, 71.0 / 24.0, -77.0 / 12.0, 5.0 / 1.0, 0.0 / 1.0}},
            {{-1.0 / 12.0, 13.0 / 12.0, -59.0 / 12.0, 107.0 / 12.0, -5.0 / 1.0, 0.0 / 1.0}},
            {{1.0 / 12.0, -1.0 / 1.0, 49.0 / 12.0, -13.0 / 2.0, 10.0 / 3.0, 0.0 / 1.0}},
            {{-1.0 / 24.0, 11.0 / 24.0, -41.0 / 24.0, 61.0 / 24.0, -5.0 / 4.0, 0.0 / 1.0}},
            {{1.0 / 120.0, -1.0 / 12.0, 7.0 / 24.0, -5.0 / 12.0, 1.0 / 5.0, 0.0 / 1.0}}
          }},
          {{
            {{-1.0 / 120.0, 1.0 / 12.0, -7.0 / 24.0, 5.0 / 12.0, -1.0 / 5.0, 0.0 / 1.0}},
            {{1.0 / 24.0, -3.0 / 8.0, 25.0 / 24.0, -5.0 / 8.0, -13.0 / 12.0, 1.0 / 1.0}},
            {{-1.0 / 12.0, 2.0 / 3.0, -17.0 / 12.0, -1.0 / 6.0, 2.0 / 1.0, 0.0 / 1.0}},
            {{1.0 / 12.0, -7.0 / 12.0, 11.0 / 12.0, 7.0 / 12.0, -1.0 / 1.0, 0.0 / 1.0}},
            {{-1.0 / 24.0, 1.0 / 4.0, -7.0 / 24.0, -1.0 / 4.0, 1.0 / 3.0, 0.0 / 1.0}},
            {{1.0 / 120.0, -1.0 / 24.0, 1.0 / 24.0, 1.0 / 24.0, -1.0 / 20.0, 0.0 / 1.0}}
          }},
          {{
            {{-1.0 / 120.0, 1.0 / 24.0, -1.0 / 24.0, -1.0 / 24.0, 1.0 / 20.0, 0.0 / 1.0}},
            {{1.0 / 24.0, -1.0 / 6.0, -1.0 / 24.0, 2.0 / 3.0, -1.0 / 2.0, 0.0 / 1.0}},
            {{-1.0 / 12.0, 1.0 / 4.0, 5.0 / 12.0, -5.0 / 4.0, -1.0 / 3.0, 1.0 / 1.0}},
            {{1.0 / 12.0, -1.0 / 6.0, -7.0 / 12.0, 2.0 / 3.0, 1.0 / 1.0, 0.0 / 1.0}},
            {{-1.0 / 24.0, 1.0 / 24.0, 7.0 / 24.0, -1.0 / 24.0, -1.0 / 4.0, 0.0 / 1.0}},
            {{1.0 / 120.0, 0.0 / 1.0, -1.0 / 24.0, 0.0 / 1.0, 1.0 / 30.0, 0.0 / 1.0}}
          }},
          {{
            {{-1.0 / 120.0, 0.0 / 1.0, 1.0 / 24.0, 0.0 / 1.0, -1.0 / 30.0, 0.0 / 1.0}},
            {{1.0 / 24.0, 1.0 / 24.0, -7.0 / 24.0, -1.0 / 24.0, 1.0 / 4.0, 0.0 / 1.0}},
            {{-1.0 / 12.0, -1.0 / 6.0, 7.0 / 12.0, 2.0 / 3.0, -1.0 / 1.0, 0.0 / 1.0}},
            {{1.0 / 12.0, 1.0 / 4.0, -5.0 / 12.0, -5.0 / 4.0, 1.0 / 3.0, 1.0 / 1.0}},
            {{-1.0 / 24.0, -1.0 / 6.0, 1.0 / 24.0, 2.0 / 3.0, 1.0 / 2.0, 0.0 / 1.0}},
            {{1.0 / 120.0, 1.0 / 24.0, 1.0 / 24.0, -1.0 / 24.0, -1.0 / 20.0, 0.0 / 1.0}}
          }},
          {{
            {{-1.0 / 120.0, -1.0 / 24.0, -1.0 / 24.0, 1.0 / 24.0, 1.0 / 20.0, 0.0 / 1.0}},
            {{1.0 / 24.0, 1.0 / 4.0, 7.0 / 24.0, -1.0 / 4.0, -1.0 / 3.0, 0.0 / 1.0}},
            {{-1.0 / 12.0, -7.0 / 12.0, -11.0 / 12.0, 7.0 / 12.0, 1.0 / 1.0, 0.0 / 1.0}},
            {{1.0 / 12.0, 2.0 / 3.0, 17.0 / 12.0, -1.0 / 6.0, -2.0 / 1.0, 0.0 / 1.0}},
            {{-1.0 / 24.0, -3.0 / 8.0, -25.0 / 24.0, -5.0 / 8.0, 13.0 / 12.0, 1.0 / 1.0}},
            {{1.0 / 120.0, 1.0 / 12.0, 7.0 / 24.0, 5.0 / 12.0, 1.0 / 5.0, 0.0 / 1.0}}
          }}
        }},
        // fe_degree == 7
        {{
          {{
            {{-1.0 / 5040.0, 1.0 / 180.0, -23.0 / 360.0, 7.0 / 18.0, -967.0 / 720.0, 469.0 / 180.0, -363.0 / 140.0, 1.0 / 1.0}},
            {{1.0 / 720.0, -3.0 / 80.0, 59.0 / 144.0, -37.0 / 16.0, 319.0 / 45.0, -223.0 / 20.0, 7.0 / 1.0, 0.0 / 1.0}},
            {{-1.0 / 240.0, 13.0 / 120.0, -9.0 / 8.0, 71.0 / 12.0, -3929.0 / 240.0, 879.0 / 40.0, -21.0 / 2.0, 0.0 / 1.0}},
            {{1.0 / 144.0, -25.0 / 144.0, 247.0 / 144.0, -1219.0 / 144.0, 389.0 / 18.0, -949.0 / 36.0, 35.0 / 3.0, 0.0 / 1.0}},
            {{-1.0 / 144.0, 1.0 / 6.0, -113.0 / 72.0, 22.0 / 3.0, -2545.0 / 144.0, 41.0 / 2.0, -35.0 / 4.0, 0.0 / 1.0}},
            {{1.0 / 240.0, -23.0 / 240.0, 69.0 / 80.0, -185.0 / 48.0, 134.0 / 15.0, -201.0 / 20.0, 21.0 / 5.0, 0.0 / 1.0}},
            {{-1.0 / 720.0, 11.0 / 360.0, -19.0 / 72.0, 41.0 / 36.0, -1849.0 / 720.0, 1019.0 / 360.0, -7.0 / 6.0, 0.0 / 1.0}},
            {{1.0 / 5040.0, -1.0 / 240.0, 5.0 / 144.0, -7.0 / 48.0, 29.0 / 90.0, -7.0 / 20.0, 1.0 / 7.0, 0.0 / 1.0}}
          }},
          {{
            {{-1.0 / 5040.0, 1.0 / 240.0, -5.0 / 144.0, 7.0 / 48.0, -29.0 / 90.0, 7.0 / 20.0, -1.0 / 7.0, 0.0 / 1.0}},
            {{1.0 / 720.0, -1.0 / 36.0, 77.0 / 360.0, -7.0 / 9.0, 889.0 / 720.0, -7.0 / 36.0, -29.0 / 20.0, 1.0 / 1.0}},
            {{-1.0 / 240.0, 19.0 / 240.0, -9.0 / 16.0, 85.0 / 48.0, -29.0 / 15.0, -27.0 / 20.0, 3.0 / 1.0, 0.0 / 1.0}},
            {{1.0 / 144.0, -1.0 / 8.0, 59.0 / 72.0, -9.0 / 4.0, 241.0 / 144.0, 19.0 / 8.0, -5.0 / 2.0, 0.0 / 1.0}},
            {{-1.0 / 144.0, 17.0 / 144.0, -103.0 / 144.0, 251.0 / 144.0, -17.0 / 18.0, -67.0 / 36.0, 5.0 / 3.0, 0.0 / 1.0}},
            {{1.0 / 240.0, -1.0 / 15.0, 3.0 / 8.0, -5.0 / 6.0, 89.0 / 240.0, 9.0 / 10.0, -3.0 / 4.0, 0.0 / 1.0}},
            {{-1.0 / 720.0, 1.0 / 48.0, -79.0 / 720.0, 11.0 / 48.0, -4.0 / 45.0, -1.0 / 4.0, 1.0 / 5.0, 0.0 / 1.0}},
            {{1.0 / 5040.0, -1.0 / 360.0, 1.0 / 72.0, -1.0 / 36.0, 7.0 / 720.0, 11.0 / 360.0, -1.0 / 42.0, 0.0 / 1.0}}
          }},
          {{
            {{-1.0 / 5040.0, 1.0 / 360.0, -1.0 / 72.0, 1.0 / 36.0, -7.0 / 720.0, -11.0 / 360.0, 1.0 / 42.0, 0.0 / 1.0}},
            {{1.0 / 720.0, -13.0 / 720.0, 11.0 / 144.0, -11.0 / 144.0, -11.0 / 45.0, 107.0 / 180.0, -1.0 / 3.0, 0.0 / 1.0}},
            {{-1.0 / 240.0, 1.0 / 20.0, -7.0 / 40.0, 0.0 / 1.0, 77.0 / 80.0, -21.0 / 20.0, -47.0 / 60.0, 1.0 / 1.0}},
            {{1.0 / 144.0, -11.0 / 144.0, 31.0 / 144.0, 31.0 / 144.0, -25.0 / 18.0, 13.0 / 36.0, 5.0 / 3.0, 0.0 / 1.0}},
            {{-1.0 / 144.0, 5.0 / 72.0, -11.0 / 72.0, -11.0 / 36.0, 143.0 / 144.0, 17.0 / 72.0, -5.0 / 6.0, 0.0 / 1.0}},
            {{1.0 / 240.0, -3.0 / 80.0, 1.0 / 16.0, 3.0 / 16.0, -2.0 / 5.0, -3.0 / 20.0, 1.0 / 3.0, 0.0 / 1.0}},
            {{-1.0 / 720.0, 1.0 / 90.0, -1.0 / 72.0, -1.0 / 18.0, 71.0 / 720.0, 2.0 / 45.0, -1.0 / 12.0, 0.0 / 1.0}},
            {{1.0 / 5040.0, -1.0 / 720.0, 1.0 / 720.0, 1.0 / 144.0, -1.0 / 90.0, -1.0 / 180.0, 1.0 / 105.0, 0.0 / 1.0}}
          }},
          {{
            {{-1.0 / 5040.0, 1.0 / 720.0, -1.0 / 720.0, -1.0 / 144.0, 1.0 / 90.0, 1.0 / 180.0, -1.0 / 105.0, 0.0 / 1.0}},
            {{1.0 / 720.0, -1.0 / 120.0, -1.0 / 360.0, 1.0 / 12.0, -71.0 / 720.0, -3.0 / 40.0, 1.0 / 10.0, 0.0 / 1.0}},
            {{-1.0 / 240.0, 1.0 / 48.0, 3.0 / 80.0, -13.0 / 48.0, 1.0 / 15.0, 3.0 / 4.0, -3.0 / 5.0, 0.0 / 1.0}},
            {{1.0 / 144.0, -1.0 / 36.0, -7.0 / 72.0, 7.0 / 18.0, 49.0 / 144.0, -49.0 / 36.0, -1.0 / 4.0, 1.0 / 1.0}},
            {{-1.0 / 144.0, 1.0 / 48.0, 17.0 / 144.0, -13.0 / 48.0, -11.0 / 18.0, 3.0 / 4.0, 1.0 / 1.0, 0.0 / 1.0}},
            {{1.0 / 240.0, -1.0 / 120.0, -3.0 / 40.0, 1.0 / 12.0, 89.0 / 240.0, -3.0 / 40.0, -3.0 / 10.0, 0.0 / 1.0}},
            {{-1.0 / 720.0, 1.0 / 720.0, 17.0 / 720.0, -1.0 / 144.0, -4.0 / 45.0, 1.0 / 180.0, 1.0 / 15.0, 0.0 / 1.0}},
            {{1.0 / 5040.0, 0.0 / 1.0, -1.0 / 360.0, 0.0 / 1.0, 7.0 / 720.0, 0.0 / 1.0, -1.0 / 140.0, 0.0 / 1.0}}
          }},
          {{
            {{-1.0 / 5040.0, 0.0 / 1.0, 1.0 / 360.0, 0.0 / 1.0, -7.0 / 720.0, 0.0 / 1.0, 1.0 / 140.0, 0.0 / 1.0}},
            {{1.0 / 720.0, 1.0 / 720.0, -17.0 / 720.0, -1.0 / 144.0, 4.0 / 45.0, 1.0 / 180.0, -1.0 / 15.0, 0.0 / 1.0}},
            {{-1.0 / 240.0, -1.0 / 120.0, 3.0 / 40.0, 1.0 / 12.0, -89.0 / 240.0, -3.0 / 40.0, 3.0 / 10.0, 0.0 / 1.0}},
            {{1.0 / 144.0, 1.0 / 48.0, -17.0 / 144.0, -13.0 / 48.0, 11.0 / 18.0, 3.0 / 4.0, -1.0 / 1.0, 0.0 / 1.0}},
            {{-1.0 / 144.0, -1.0 / 36.0, 7.0 / 72.0, 7.0 / 18.0, -49.0 / 144.0, -49.0 / 36.0, 1.0 / 4.0, 1.0 / 1.0}},
            {{1.0 / 240.0, 1.0 / 48.0, -3.0 / 80.0, -13.0 / 48.0, -1.0 / 15.0, 3.0 / 4.0, 3.0 / 5.0, 0.0 / 1.0}},
            {{-1.0 / 720.0, -1.0 / 120.0, 1.0 / 360.0, 1.0 / 12.0, 71.0 / 720.0, -3.0 / 40.0, -1.0 / 10.0, 0.0 / 1.0}},
            {{1.0 / 5040.0, 1.0 / 720.0, 1.0 / 720.0, -1.0 / 144.0, -1.0 / 90.0, 1.0 / 180.0, 1.0 / 105.0, 0.0 / 1.0}}
          }},
          {{
            {{-1.0 / 5040.0, -1.0 / 720.0, -1.0 / 720.0, 1.0 / 144.0, 1.0 / 90.0, -1.0 / 180.0, -1.0 / 105.0, 0.0 / 1.0}},
            {{1.0 / 720.0, 1.0 / 90.0, 1.0 / 72.0, -1.0 / 18.0, -71.0 / 720.0, 2.0 / 45.0, 1.0 / 12.0, 0.0 / 1.0}},
            {{-1.0 / 240.0, -3.0 / 80.0, -1.0 / 16.0, 3.0 / 16.0, 2.0 / 5.0, -3.0 / 20.0, -1.0 / 3.0, 0.0 / 1.0}},
            {{1.0 / 144.0, 5.0 / 72.0, 11.0 / 72.0, -11.0 / 36.0, -143.0 / 144.0, 17.0 / 72.0, 5.0 / 6.0, 0.0 / 1.0}},
            {{-1.0 / 144.0, -11.0 / 144.0, -31.0 / 144.0, 31.0 / 144.0, 25.0 / 18.0, 13.0 / 36.0, -5.0 / 3.0, 0.0 / 1.0}},
            {{1.0 / 240.0, 1.0 / 20.0, 7.0 / 40.0, 0.0 / 1.0, -77.0 / 80.0, -21.0 / 20.0, 47.0 / 60.0, 1.0 / 1.0}},
            {{-1.0 / 720.0, -13.0 / 720.0, -11.0 / 144.0, -11.0 / 144.0, 11.0 / 45.0, 107.0 / 180.0, 1.0 / 3.0, 0.0 / 1.0}},
            {{1.0 / 5040.0, 1.0 / 360.0, 1.0 / 72.0, 1.0 / 36.0, 7.0 / 720.0, -11.0 / 360.0, -1.0 / 42.0, 0.0 / 1.0}}
          }},
          {{
            {{-1.0 / 5040.0, -1.0 / 360.0, -1.0 / 72.0, -1.0 / 36.0, -7.0 / 720.0, 11.0 / 360.0, 1.0 / 42.0, 0.0 / 1.0}},
            {{1.0 / 720.0, 1.0 / 48.0, 79.0 / 720.0, 11.0 / 48.0, 4.0 / 45.0, -1.0 / 4.0, -1.0 / 5.0, 0.0 / 1.0}},
            {{-1.0 / 240.0, -1.0 / 15.0, -3.0 / 8.0, -5.0 / 6.0, -89.0 / 240.0, 9.0 / 10.0, 3.0 / 4.0, 0.0 / 1.0}},
            {{1.0 / 144.0, 17.0 / 144.0, 103.0 / 144.0, 251.0 / 144.0, 17.0 / 18.0, -67.0 / 36.0, -5.0 / 3.0, 0.0 / 1.0}},
            {{-1.0 / 144.0, -1.0 / 8.0, -59.0 / 72.0, -9.0 / 4.0, -241.0 / 144.0, 19.0 / 8.0, 5.0 / 2.0, 0.0 / 1.0}},
            {{1.0 / 240.0, 19.0 / 240.0, 9.0 / 16.0, 85.0 / 48.0, 29.0 / 15.0, -27.0 / 20.0, -3.0 / 1.0, 0.0 / 1.0}},
            {{-1.0 / 720.0, -1.0 / 36.0, -77.0 / 360.0, -7.0 / 9.0, -889.0 / 720.0, -7.0 / 36.0, 29.0 / 20.0, 1.0 / 1.0}},
            {{1.0 / 5040.0, 1.0 / 240.0, 5.0 / 144.0, 7.0 / 48.0, 29.0 / 90.0, 7.0 / 20.0, 1.0 / 7.0, 0.0 / 1.0}}
          }}
        }},
        // fe_degree == 9
        {{
          {{
            {{-1.0 / 362880.0, 1.0 / 8064.0, -29.0 / 12096.0, 5.0 / 192.0, -3013.0 / 17280.0, 95.0 / 128.0, -4523.0 / 2268.0, 6515.0 / 2016.0, -7129.0 / 2520.0, 1.0 / 1.0}},
            {{1.0 / 40320.0, -11.0 / 10080.0, 59.0 / 2880.0, -77.0 / 360.0, 7807.0 / 5760.0, -7667.0 / 1440.0, 14139.0 / 1120.0, -4609.0 / 280.0, 9.0 / 1.0, 0.0 / 1.0}},
            {{-1.0 / 10080.0, 43.0 / 10080.0, -7.0 / 90.0, 563.0 / 720.0, -6787.0 / 1440.0, 24901.0 / 1440.0, -20837.0 / 560.0, 5869.0 / 140.0, -18.0 / 1.0, 0.0 / 1.0}},
            {{1.0 / 4320.0, -7.0 / 720.0, 31.0 / 180.0, -401.0 / 240.0, 13873.0 / 1440.0, -4013.0 / 120.0, 72569.0 / 1080.0, -6289.0 / 90.0, 28.0 / 1.0, 0.0 / 1.0}},
            {{-1.0 / 2880.0, 41.0 / 2880.0, -353.0 / 1440.0, 3313.0 / 1440.0, -36769.0 / 2880.0, 122249.0 / 2880.0, -6519.0 / 80.0, 6499.0 / 80.0, -63.0 / 2.0, 0.0 / 1.0}},
            {{1.0 / 2880.0, -1.0 / 72.0, 67.0 / 288.0, -305.0 / 144.0, 32773.0 / 2880.0, -5273.0 / 144.0, 1091.0 / 16.0, -265.0 / 4.0, 126.0 / 5.0, 0.0 / 1.0}},
            {{-1.0 / 4320.0, 13.0 / 1440.0, -53.0 / 360.0, 313.0 / 240.0, -9823.0 / 1440.0, 10279.0 / 480.0, -84307.0 / 2160.0, 6709.0 / 180.0, -14.0 / 1.0, 0.0 / 1.0}},
            {{1.0 / 10080.0, -19.0 / 5040.0, 151.0 / 2520.0, -373.0 / 720.0, 3817.0 / 1440.0, -2939.0 / 360.0, 4101.0 / 280.0, -967.0 / 70.0, 36.0 / 7.0, 0.0 / 1.0}},
            {{-1.0 / 40320.0, 37.0 / 40320.0, -41.0 / 2880.0, 347.0 / 2880.0, -3487.0 / 5760.0, 10579.0 / 5760.0, -1823.0 / 560.0, 3407.0 / 1120.0, -9.0 / 8.0, 0.0 / 1.0}},
            {{1.0 / 362880.0, -1.0 / 10080.0, 13.0 / 8640.0, -1.0 / 80.0, 1069.0 / 17280.0, -89.0 / 480.0, 29531.0 / 90720.0, -761.0 / 2520.0, 1.0 / 9.0, 0.0 / 1.0}}
          }},
          {{
            {{-1.0 / 362880.0, 1.0 / 10080.0, -13.0 / 8640.0, 1.0 / 80.0, -1069.0 / 17280.0, 89.0 / 480.0, -29531.0 / 90720.0, 761.0 / 2520.0, -1.0 / 9.0, 0.0 / 1.0}},
            {{1.0 / 40320.0, -1.0 / 1152.0, 17.0 / 1344.0, -19.0 / 192.0, 853.0 / 1920.0, -427.0 / 384.0, 1271.0 / 1008.0, 61.0 / 288.0, -481.0 / 280.0, 1.0 / 1.0}},
            {{-1.0 / 10080.0, 17.0 / 5040.0, -17.0 / 360.0, 251.0 / 720.0, -2057.0 / 1440.0, 1087.0 / 360.0, -5101.0 / 2520.0, -201.0 / 70.0, 4.0 / 1.0, 0.0 / 1.0}},
            {{1.0 / 4320.0, -11.0 / 1440.0, 37.0 / 360.0, -517.0 / 720.0, 1301.0 / 480.0, -7139.0 / 1440.0, 4003.0 / 2160.0, 341.0 / 60.0, -14.0 / 3.0, 0.0 / 1.0}},
            {{-1.0 / 2880.0, 1.0 / 90.0, -23.0 / 160.0, 229.0 / 240.0, -3223.0 / 960.0, 1319.0 / 240.0, -839.0 / 720.0, -1163.0 / 180.0, 14.0 / 3.0, 0.0 / 1.0}},
            {{1.0 / 2880.0, -31.0 / 2880.0, 193.0 / 1440.0, -1223.0 / 1440.0, 8129.0 / 2880.0, -12319.0 / 2880.0, 391.0 / 720.0, 411.0 / 80.0, -7.0 / 2.0, 0.0 / 1.0}},
            {{-1.0 / 4320.0, 1.0 / 144.0, -1.0 / 12.0, 73.0 / 144.0, -2321.0 / 1440.0, 167.0 / 72.0, -37.0 / 216.0, -17.0 / 6.0, 28.0 / 15.0, 0.0 / 1.0}},
            {{1.0 / 10080.0, -29.0 / 10080.0, 1.0 / 30.0, -47.0 / 240.0, 289.0 / 480.0, -401.0 / 480.0, 157.0 / 5040.0, 1303.0 / 1260.0, -2.0 / 3.0, 0.0 / 1.0}},
            {{-1.0 / 40320.0, 1.0 / 1440.0, -157.0 / 20160.0, 2.0 / 45.0, -767.0 / 5760.0, 259.0 / 1440.0, -19.0 / 10080.0, -9.0 / 40.0, 1.0 / 7.0, 0.0 / 1.0}},
            {{1.0 / 362880.0, -1.0 / 13440.0, 7.0 / 8640.0, -13.0 / 2880.0, 229.0 / 17280.0, -101.0 / 5760.0, -1.0 / 5670.0, 223.0 / 10080.0, -1.0 / 72.0, 0.0 / 1.0}}
          }},
          {{
            {{-1.0 / 362880.0, 1.0 / 13440.0, -7.0 / 8640.0, 13.0 / 2880.0, -229.0 / 17280.0, 101.0 / 5760.0, 1.0 / 5670.0, -223.0 / 10080.0, 1.0 / 72.0, 0.0 / 1.0}},
            {{1.0 / 40320.0, -13.0 / 20160.0, 19.0 / 2880.0, -47.0 / 1440.0, 407.0 / 5760.0, 29.0 / 2880.0, -3299.0 / 10080.0, 293.0 / 560.0, -1.0 / 4.0, 0.0 / 1.0}},
            {{-1.0 / 10080.0, 5.0 / 2016.0, -1.0 / 42.0, 5.0 / 48.0, -73.0 / 480.0, -31.0 / 96.0, 1279.0 / 1008.0, -395.0 / 504.0, -153.0 / 140.0, 1.0 / 1.0}},
            {{1.0 / 4320.0, -1.0 / 180.0, 1.0 / 20.0, -139.0 / 720.0, 233.0 / 1440.0, 659.0 / 720.0, -2209.0 / 1080.0, -13.0 / 60.0, 7.0 / 3.0, 0.0 / 1.0}},
            {{-1.0 / 2880.0, 23.0 / 2880.0, -97.0 / 1440.0, 331.0 / 1440.0, -209.0 / 2880.0, -3673.0 / 2880.0, 1361.0 / 720.0, 83.0 / 80.0, -7.0 / 4.0, 0.0 / 1.0}},
            {{1.0 / 2880.0, -11.0 / 1440.0, 29.0 / 480.0, -11.0 / 60.0, -17.0 / 960.0, 517.0 / 480.0, -871.0 / 720.0, -319.0 / 360.0, 7.0 / 6.0, 0.0 / 1.0}},
            {{-1.0 / 4320.0, 7.0 / 1440.0, -13.0 / 360.0, 71.0 / 720.0, 19.0 / 480.0, -857.0 / 1440.0, 1253.0 / 2160.0, 59.0 / 120.0, -7.0 / 12.0, 0.0 / 1.0}},
            {{1.0 / 10080.0, -1.0 / 504.0, 1.0 / 72.0, -5.0 / 144.0, -31.0 / 1440.0, 31.0 / 144.0, -97.0 / 504.0, -5.0 / 28.0, 1.0 / 5.0, 0.0 / 1.0}},
            {{-1.0 / 40320.0, 19.0 / 40320.0, -1.0 / 320.0, 7.0 / 960.0, 11.0 / 1920.0, -89.0 / 1920.0, 197.0 / 5040.0, 389.0 / 10080.0, -1.0 / 24.0, 0.0 / 1.0}},
            {{1.0 / 362880.0, -1.0 / 20160.0, 19.0 / 60480.0, -1.0 / 1440.0, -11.0 / 17280.0, 13.0 / 2880.0, -331.0 / 90720.0, -19.0 / 5040.0, 1.0 / 252.0, 0.0 / 1.0}}
          }},
          {{
            {{-1.0 / 362880.0, 1.0 / 20160.0, -19.0 / 60480.0, 1.0 / 1440.0, 11.0 / 17280.0, -13.0 / 2880.0, 331.0 / 90720.0, 19.0 / 5040.0, -1.0 / 252.0, 0.0 / 1.0}},
            {{1.0 / 40320.0, -17.0 / 40320.0, 47.0 / 20160.0, -7.0 / 2880.0, -113.0 / 5760.0, 361.0 / 5760.0, -61.0 / 1680.0, -67.0 / 1120.0, 3.0 / 56.0, 0.0 / 1.0}},
            {{-1.0 / 10080.0, 1.0 / 630.0, -19.0 / 2520.0, -1.0 / 720.0, 143.0 / 1440.0, -139.0 / 720.0, -137.0 / 840.0, 97.0 / 140.0, -3.0 / 7.0, 0.0 / 1.0}},
            {{1.0 / 4320.0, -1.0 / 288.0, 1.0 / 72.0, 1.0 / 48.0, -329.0 / 1440.0, 7.0 / 32.0, 359.0 / 432.0, -89.0 / 72.0, -37.0 / 60.0, 1.0 / 1.0}},
            {{-1.0 / 2880.0, 7.0 / 1440.0, -23.0 / 1440.0, -17.0 / 360.0, 851.0 / 2880.0, -47.0 / 1440.0, -307.0 / 240.0, 23.0 / 40.0, 3.0 / 2.0, 0.0 / 1.0}},
            {{1.0 / 2880.0, -13.0 / 2880.0, 17.0 / 1440.0, 79.0 / 1440.0, -671.0 / 2880.0, -397.0 / 2880.0, 233.0 / 240.0, 7.0 / 80.0, -3.0 / 4.0, 0.0 / 1.0}},
            {{-1.0 / 4320.0, 1.0 / 360.0, -1.0 / 180.0, -3.0 / 80.0, 167.0 / 1440.0, 31.0 / 240.0, -479.0 / 1080.0, -17.0 / 180.0, 1.0 / 3.0, 0.0 / 1.0}},
            {{1.0 / 10080.0, -11.0 / 10080.0, 1.0 / 630.0, 11.0 / 720.0, -53.0 / 1440.0, -77.0 / 1440.0, 239.0 / 1680.0, 11.0 / 280.0, -3.0 / 28.0, 0.0 / 1.0}},
            {{-1.0 / 40320.0, 1.0 / 4032.0, -1.0 / 4032.0, -1.0 / 288.0, 41.0 / 5760.0, 7.0 / 576.0, -19.0 / 672.0, -1.0 / 112.0, 3.0 / 140.0, 0.0 / 1.0}},
            {{1.0 / 362880.0, -1.0 / 40320.0, 1.0 / 60480.0, 1.0 / 2880.0, -11.0 / 17280.0, -7.0 / 5760.0, 59.0 / 22680.0, 1.0 / 1120.0, -1.0 / 504.0, 0.0 / 1.0}}
          }},
          {{
            {{-1.0 / 362880.0, 1.0 / 40320.0, -1.0 / 60480.0, -1.0 / 2880.0, 11.0 / 17280.0, 7.0 / 5760.0, -59.0 / 22680.0, -1.0 / 1120.0, 1.0 / 504.0, 0.0 / 1.0}},
            {{1.0 / 40320.0, -1.0 / 5040.0, -1.0 / 6720.0, 1.0 / 240.0, -11.0 / 1920.0, -1.0 / 60.0, 299.0 / 10080.0, 4.0 / 315.0, -1.0 / 42.0, 0.0 / 1.0}},
            {{-1.0 / 10080.0, 1.0 / 1440.0, 1.0 / 630.0, -13.0 / 720.0, 13.0 / 1440.0, 169.0 / 1440.0, -773.0 / 5040.0, -1.0 / 10.0, 1.0 / 7.0, 0.0 / 1.0}},
            {{1.0 / 4320.0, -1.0 / 720.0, -1.0 / 180.0, 29.0 / 720.0, 11.0 / 480.0, -61.0 / 180.0, 161.0 / 1080.0, 4.0 / 5.0, -2.0 / 3.0, 0.0 / 1.0}},
            {{-1.0 / 2880.0, 1.0 / 576.0, 1.0 / 96.0, -5.0 / 96.0, -91.0 / 960.0, 91.0 / 192.0, 41.0 / 144.0, -205.0 / 144.0, -1.0 / 5.0, 1.0 / 1.0}},
            {{1.0 / 2880.0, -1.0 / 720.0, -17.0 / 1440.0, 29.0 / 720.0, 389.0 / 2880.0, -61.0 / 180.0, -449.0 / 720.0, 4.0 / 5.0, 1.0 / 1.0, 0.0 / 1.0}},
            {{-1.0 / 4320.0, 1.0 / 1440.0, 1.0 / 120.0, -13.0 / 720.0, -143.0 / 1440.0, 169.0 / 1440.0, 917.0 / 2160.0, -1.0 / 10.0, -1.0 / 3.0, 0.0 / 1.0}},
            {{1.0 / 10080.0, -1.0 / 5040.0, -1.0 / 280.0, 1.0 / 240.0, 19.0 / 480.0, -1.0 / 60.0, -331.0 / 2520.0, 4.0 / 315.0, 2.0 / 21.0, 0.0 / 1.0}},
            {{-1.0 / 40320.0, 1.0 / 40320.0, 17.0 / 20160.0, -1.0 / 2880.0, -47.0 / 5760.0, 7.0 / 5760.0, 127.0 / 5040.0, -1.0 / 1120.0, -1.0 / 56.0, 0.0 / 1.0}},
            {{1.0 / 362880.0, 0.0 / 1.0, -1.0 / 12096.0, 0.0 / 1.0, 13.0 / 17280.0, 0.0 / 1.0, -41.0 / 18144.0, 0.0 / 1.0, 1.0 / 630.0, 0.0 / 1.0}}
          }},
          {{
            {{-1.0 / 362880.0, 0.0 / 1.0, 1.0 / 12096.0, 0.0 / 1.0, -13.0 / 17280.0, 0.0 / 1.0, 41.0 / 18144.0, 0.0 / 1.0, -1.0 / 630.0, 0.0 / 1.0}},
            {{1.0 / 40320.0, 1.0 / 40320.0, -17.0 / 20160.0, -1.0 / 2880.0, 47.0 / 5760.0, 7.0 / 5760.0, -127.0 / 5040.0, -1.0 / 1120.0, 1.0 / 56.0, 0.0 / 1.0}},
            {{-1.0 / 10080.0, -1.0 / 5040.0, 1.0 / 280.0, 1.0 / 240.0, -19.0 / 480.0, -1.0 / 60.0, 331.0 / 2520.0, 4.0 / 315.0, -2.0 / 21.0, 0.0 / 1.0}},
            {{1.0 / 4320.0, 1.0 / 1440.0, -1.0 / 120.0, -13.0 / 720.0, 143.0 / 1440.0, 169.0 / 1440.0, -917.0 / 2160.0, -1.0 / 10.0, 1.0 / 3.0, 0.0 / 1.0}},
            {{-1.0 / 2880.0, -1.0 / 720.0, 17.0 / 1440.0, 29.0 / 720.0, -389.0 / 2880.0, -61.0 / 180.0, 449.0 / 720.0, 4.0 / 5.0, -1.0 / 1.0, 0.0 / 1.0}},
            {{1.0 / 2880.0, 1.0 / 576.0, -1.0 / 96.0, -5.0 / 96.0, 91.0 / 960.0, 91.0 / 192.0, -41.0 / 144.0, -205.0 / 144.0, 1.0 / 5.0, 1.0 / 1.0}},
            {{-1.0 / 4320.0, -1.0 / 720.0, 1.0 / 180.0, 29.0 / 720.0, -11.0 / 480.0, -61.0 / 180.0, -161.0 / 1080.0, 4.0 / 5.0, 2.0 / 3.0, 0.0 / 1.0}},
            {{1.0 / 10080.0, 1.0 / 1440.0, -1.0 / 630.0, -13.0 / 720.0, -13.0 / 1440.0, 169.0 / 1440.0, 773.0 / 5040.0, -1.0 / 10.0, -1.0 / 7.0, 0.0 / 1.0}},
            {{-1.0 / 40320.0, -1.0 / 5040.0, 1.0 / 6720.0, 1.0 / 240.0, 11.0 / 1920.0, -1.0 / 60.0, -299.0 / 10080.0, 4.0 / 315.0, 1.0 / 42.0, 0.0 / 1.0}},
            {{1.0 / 362880.0, 1.0 / 40320.0, 1.0 / 60480.0, -1.0 / 2880.0, -11.0 / 17280.0, 7.0 / 5760.0, 59.0 / 22680.0, -1.0 / 1120.0, -1.0 / 504.0, 0.0 / 1.0}}
          }},
          {{
            {{-1.0 / 362880.0, -1.0 / 40320.0, -1.0 / 60480.0, 1.0 / 2880.0, 11.0 / 17280.0, -7.0 / 5760.0, -59.0 / 22680.0, 1.0 / 1120.0, 1.0 / 504.0, 0.0 / 1.0}},
            {{1.0 / 40320.0, 1.0 / 4032.0, 1.0 / 4032.0, -1.0 / 288.0, -41.0 / 5760.0, 7.0 / 576.0, 19.0 / 672.0, -1.0 / 112.0, -3.0 / 140.0, 0.0 / 1.0}},
            {{-1.0 / 10080.0, -11.0 / 10080.0, -1.0 / 630.0, 11.0 / 720.0, 53.0 / 1440.0, -77.0 / 1440.0, -239.0 / 1680.0, 11.0 / 280.0, 3.0 / 28.0, 0.0 / 1.0}},
            {{1.0 / 4320.0, 1.0 / 360.0, 1.0 / 180.0, -3.0 / 80.0, -167.0 / 1440.0, 31.0 / 240.0, 479.0 / 1080.0, -17.0 / 180.0, -1.0 / 3.0, 0.0 / 1.0}},
            {{-1.0 / 2880.0, -13.0 / 2880.0, -17.0 / 1440.0, 79.0 / 1440.0, 671.0 / 2880.0, -397.0 / 2880.0, -233.0 / 240.0, 7.0 / 80.0, 3.0 / 4.0, 0.0 / 1.0}},
            {{1.0 / 2880.0, 7.0 / 1440.0, 23.0 / 1440.0, -17.0 / 360.0, -851.0 / 2880.0, -47.0 / 1440.0, 307.0 / 240.0, 23.0 / 40.0, -3.0 / 2.0, 0.0 / 1.0}},
            {{-1.0 / 4320.0, -1.0 / 288.0, -1.0 / 72.0, 1.0 / 48.0, 329.0 / 1440.0, 7.0 / 32.0, -359.0 / 432.0, -89.0 / 72.0, 37.0 / 60.0, 1.0 / 1.0}},
            {{1.0 / 10080.0, 1.0 / 630.0, 19.0 / 2520.0, -1.0 / 720.0, -143.0 / 1440.0, -139.0 / 720.0, 137.0 / 840.0, 97.0 / 140.0, 3.0 / 7.0, 0.0 / 1.0}},
            {{-1.0 / 40320.0, -17.0 / 40320.0, -47.0 / 20160.0, -7.0 / 2880.0, 113.0 / 5760.0, 361.0 / 5760.0, 61.0 / 1680.0, -67.0 / 1120.0, -3.0 / 56.0, 0.0 / 1.0}},
            {{1.0 / 362880.0, 1.0 / 20160.0, 19.0 / 60480.0, 1.0 / 1440.0, -11.0 / 17280.0, -13.0 / 2880.0, -331.0 / 90720.0, 19.0 / 5040.0, 1.0 / 252.0, 0.0 / 1.0}}
          }},
          {{
            {{-1.0 / 362880.0, -1.0 / 20160.0, -19.0 / 60480.0, -1.0 / 1440.0, 11.0 / 17280.0, 13.0 / 2880.0, 331.0 / 90720.0, -19.0 / 5040.0, -1.0 / 252.0, 0.0 / 1.0}},
            {{1.0 / 40320.0, 19.0 / 40320.0, 1.0 / 320.0, 7.0 / 960.0, -11.0 / 1920.0, -89.0 / 1920.0, -197.0 / 5040.0, 389.0 / 10080.0, 1.0 / 24.0, 0.0 / 1.0}},
            {{-1.0 / 10080.0, -1.0 / 504.0, -1.0 / 72.0, -5.0 / 144.0, 31.0 / 1440.0, 31.0 / 144.0, 97.0 / 504.0, -5.0 / 28.0, -1.0 / 5.0, 0.0 / 1.0}},
            {{1.0 / 4320.0, 7.0 / 1440.0, 13.0 / 360.0, 71.0 / 720.0, -19.0 / 480.0, -857.0 / 1440.0, -1253.0 / 2160.0, 59.0 / 120.0, 7.0 / 12.0, 0.0 / 1.0}},
            {{-1.0 / 2880.0, -11.0 / 1440.0, -29.0 / 480.0, -11.0 / 60.0, 17.0 / 960.0, 517.0 / 480.0, 871.0 / 720.0, -319.0 / 360.0, -7.0 / 6.0, 0.0 / 1.0}},
            {{1.0 / 2880.0, 23.0 / 2880.0, 97.0 / 1440.0, 331.0 / 1440.0, 209.0 / 2880.0, -3673.0 / 2880.0, -1361.0 / 720.0, 83.0 / 80.0, 7.0 / 4.0, 0.0 / 1.0}},
            {{-1.0 / 4320.0, -1.0 / 180.0, -1.0 / 20.0, -139.0 / 720.0, -233.0 / 1440.0, 659.0 / 720.0, 2209.0 / 1080.0, -13.0 / 60.0, -7.0 / 3.0, 0.0 / 1.0}},
            {{1.0 / 10080.0, 5.0 / 2016.0, 1.0 / 42.0, 5.0 / 48.0, 73.0 / 480.0, -31.0 / 96.0, -1279.0 / 1008.0, -395.0 / 504.0, 153.0 / 140.0, 1.0 / 1.0}},
            {{-1.0 / 40320.0, -13.0 / 20160.0, -19.0 / 2880.0, -47.0 / 1440.0, -407.0 / 5760.0, 29.0 / 2880.0, 3299.0 / 10080.0, 293.0 / 560.0, 1.0 / 4.0, 0.0 / 1.0}},
            {{1.0 / 362880.0, 1.0 / 13440.0, 7.0 / 8640.0, 13.0 / 2880.0, 229.0 / 17280.0, 101.0 / 5760.0, -1.0 / 5670.0, -223.0 / 10080.0, -1.0 / 72.0, 0.0 / 1.0}}
          }},
          {{
            {{-1.0 / 362880.0, -1.0 / 13440.0, -7.0 / 8640.0, -13.0 / 2880.0, -229.0 / 17280.0, -101.0 / 5760.0, 1.0 / 5670.0, 223.0 / 10080.0, 1.0 / 72.0, 0.0 / 1.0}},
            {{1.0 / 40320.0, 1.0 / 1440.0, 157.0 / 20160.0, 2.0 / 45.0, 767.0 / 5760.0, 259.0 / 1440.0, 19.0 / 10080.0, -9.0 / 40.0, -1.0 / 7.0, 0.0 / 1.0}},
            {{-1.0 / 10080.0, -29.0 / 10080.0, -1.0 / 30.0, -47.0 / 240.0, -289.0 / 480.0, -401.0 / 480.0, -157.0 / 5040.0, 1303.0 / 1260.0, 2.0 / 3.0, 0.0 / 1.0}},
            {{1.0 / 4320.0, 1.0 / 144.0, 1.0 / 12.0, 73.0 / 144.0, 2321.0 / 1440.0, 167.0 / 72.0, 37.0 / 216.0, -17.0 / 6.0, -28.0 / 15.0, 0.0 / 1.0}},
            {{-1.0 / 2880.0, -31.0 / 2880.0, -193.0 / 1440.0, -1223.0 / 1440.0, -8129.0 / 2880.0, -12319.0 / 2880.0, -391.0 / 720.0, 411.0 / 80.0, 7.0 / 2.0, 0.0 / 1.0}},
            {{1.0 / 2880.0, 1.0 / 90.0, 23.0 / 160.0, 229.0 / 240.0, 3223.0 / 960.0, 1319.0 / 240.0, 839.0 / 720.0, -1163.0 / 180.0, -14.0 / 3.0, 0.0 / 1.0}},
            {{-1.0 / 4320.0, -11.0 / 1440.0, -37.0 / 360.0, -517.0 / 720.0, -1301.0 / 480.0, -7139.0 / 1440.0, -4003.0 / 2160.0, 341.0 / 60.0, 14.0 / 3.0, 0.0 / 1.0}},
            {{1.0 / 10080.0, 17.0 / 5040.0, 17.0 / 360.0, 251.0 / 720.0, 2057.0 / 1440.0, 1087.0 / 360.0, 5101.0 / 2520.0, -201.0 / 70.0, -4.0 / 1.0, 0.0 / 1.0}},
            {{-1.0 / 40320.0, -1.0 / 1152.0, -17.0 / 1344.0, -19.0 / 192.0, -853.0 / 1920.0, -427.0 / 384.0, -1271.0 / 1008.0, 61.0 / 288.0, 481.0 / 280.0, 1.0 / 1.0}},
            {{1.0 / 362880.0, 1.0 / 10080.0, 13.0 / 8640.0, 1.0 / 80.0, 1069.0 / 17280.0, 89.0 / 480.0, 29531.0 / 90720.0, 761.0 / 2520.0, 1.0 / 9.0, 0.0 / 1.0}}
          }},
        }}
      }};
    // clang-format on

    AssertIndexRange(fe_degree / 2, all_coefficients.size());

    for (auto coefficients : all_coefficients[fe_degree / 2])
      {
        for (unsigned int i = 0; i < coefficients.size(); ++i)
          std::reverse(coefficients[i].begin(), coefficients[i].end());

        std::vector<Polynomials::Polynomial<double>> polynomials;
        for (unsigned int i = 0; i < coefficients.size(); ++i)
          polynomials.emplace_back(coefficients[i]);

        all_polynomial.push_back(polynomials);
      }

    return all_polynomial;
  }


  template <int dim>
  std::array<unsigned int, dim>
  index_to_indices(const unsigned int                  index,
                   const std::array<unsigned int, dim> Ns)
  {
    std::array<unsigned int, dim> indices;

    if (dim >= 1)
      indices[0] = index % Ns[0];

    if (dim >= 2)
      indices[1] = (index / Ns[0]) % Ns[1];

    if (dim >= 3)
      indices[2] = index / (Ns[0] * Ns[1]);

    return indices;
  }


  template <int dim>
  std::array<unsigned int, dim>
  index_to_indices(const unsigned int index, const unsigned int N)
  {
    std::array<unsigned int, dim> Ns;
    std::fill(Ns.begin(), Ns.end(), N);
    return index_to_indices<dim>(index, Ns);
  }


  template <int dim>
  unsigned int
  indices_to_index(const std::array<unsigned int, dim> indices,
                   const std::array<unsigned int, dim> Ns)
  {
    unsigned int index = 0;

    if (dim >= 1)
      index += indices[0];

    if (dim >= 2)
      index += indices[1] * Ns[0];

    if (dim >= 3)
      index += indices[2] * Ns[0] * Ns[1];

    return index;
  }


  template <int dim>
  unsigned int
  indices_to_index(const std::array<unsigned int, dim> index,
                   const unsigned int                  N)
  {
    std::array<unsigned int, dim> Ns;
    std::fill(Ns.begin(), Ns.end(), N);
    return indices_to_index<dim>(index, Ns);
  }


  template <int dim>
  hp::FECollection<dim>
  generate_fe_collection(
    const std::vector<std::vector<Polynomials::Polynomial<double>>>
                      &all_polynomials_1D,
    const unsigned int n_components = 1)
  {
    hp::FECollection<dim> fe_collection;

    for (unsigned int p = 0; p < Utilities::pow(all_polynomials_1D.size(), dim);
         ++p)
      {
        std::vector<std::vector<Polynomials::Polynomial<double>>>
          aniso_polynomials;
        for (const auto d : index_to_indices<dim>(p, all_polynomials_1D.size()))
          aniso_polynomials.push_back(all_polynomials_1D[d]);

        fe_collection.push_back(FESystem<dim>(
          FE_GDM<dim>(AnisotropicPolynomials<dim>(aniso_polynomials)),
          n_components));
      }

    return fe_collection;
  }

} // namespace GDM
